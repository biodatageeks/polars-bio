<!DOCTYPE html>
<html class="no-js" lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="https://biodatageeks.org/polars-bio/developers/" rel="canonical"/>
<link href="../supplement/" rel="prev"/>
<link href="../contact/" rel="next"/>
<link href="../assets/logo.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.7.1" name="generator"/>
<title>üõ†Ô∏è Developers guide - polars-bio</title>
<link href="../assets/stylesheets/main.484c7ddc.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../assets/_markdown_exec_pyodide.css" rel="stylesheet"/>
<link href="../assets/_mkdocstrings.css" rel="stylesheet"/>
<script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-1M9PLLGBYS"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-1M9PLLGBYS",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-1M9PLLGBYS",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
<script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
<meta content="website" property="og:type"/>
<meta content="üõ†Ô∏è Developers guide - polars-bio" property="og:title"/>
<meta content="https://biodatageeks.org/polars-bio/assets/images/social/developers.png" property="og:image"/>
<meta content="image/png" property="og:image:type"/>
<meta content="1200" property="og:image:width"/>
<meta content="630" property="og:image:height"/>
<meta content="https://biodatageeks.org/polars-bio/developers/" property="og:url"/>
<meta content="summary_large_image" property="twitter:card"/>
<meta content="üõ†Ô∏è Developers guide - polars-bio" property="twitter:title"/>
<meta content="https://biodatageeks.org/polars-bio/assets/images/social/developers.png" property="twitter:image"/>
<link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><script src="../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
<body dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#architecture-overview">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<div data-md-color-scheme="default" data-md-component="outdated" hidden="">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="polars-bio" class="md-header__button md-logo" data-md-component="logo" href=".." title="polars-bio">
<img alt="logo" src="../assets/logo.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            polars-bio
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              üõ†Ô∏è Developers guide
            
          </span>
</div>
</div>
</div>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/biodatageeks/polars-bio" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</div>
<div class="md-source__repository">
    biodatageeks/polars-bio
  </div>
</a>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="..">
          
  
  
  Home

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../quickstart/">
        
  
  
    
  
  üèÉüèº‚Äç‚ôÇÔ∏è Quick start

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../features/">
        
  
  
    
  
  üî®Features

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../notebooks/tutorial/">
        
  
  
    
  
  üìöTutorial

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../api/">
        
  
  
    
  
  ‚öôÔ∏è API reference

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../faq/">
        
  
  
    
  
  ‚ùì FAQ

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../supplement/">
        
  
  
    
  
  üöÄ Performance

      </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="./">
        
  
  
    
  
  üõ†Ô∏è Developers guide

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../contact/">
        
  
  
    
  
  üì° Contact

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../blog/">
          
  
  
  üìñ Blog

        </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="polars-bio" class="md-nav__button md-logo" data-md-component="logo" href=".." title="polars-bio">
<img alt="logo" src="../assets/logo.png"/>
</a>
    polars-bio
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/biodatageeks/polars-bio" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</div>
<div class="md-source__repository">
    biodatageeks/polars-bio
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
<span class="md-ellipsis">
    
  
    Home
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_1_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_1">
<span class="md-nav__icon md-icon"></span>
            
  
    Home
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
<span class="md-ellipsis">
    
  
    polars-bio
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../quickstart/">
<span class="md-ellipsis">
    
  
    üèÉüèº‚Äç‚ôÇÔ∏è Quick start
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../features/">
<span class="md-ellipsis">
    
  
    üî®Features
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../notebooks/tutorial/">
<span class="md-ellipsis">
    
  
    üìöTutorial
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/">
<span class="md-ellipsis">
    
  
    ‚öôÔ∏è API reference
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../faq/">
<span class="md-ellipsis">
    
  
    ‚ùì FAQ
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../supplement/">
<span class="md-ellipsis">
    
  
    üöÄ Performance
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    
  
    üõ†Ô∏è Developers guide
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    
  
    üõ†Ô∏è Developers guide
  

    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#architecture-overview">
<span class="md-ellipsis">
      
        Architecture Overview
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#upstream-repositories">
<span class="md-ellipsis">
      
        Upstream Repositories
      
    </span>
</a>
<nav aria-label="Upstream Repositories" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#datafusion-bio-formats">
<span class="md-ellipsis">
      
        datafusion-bio-formats
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#datafusion-bio-functions">
<span class="md-ellipsis">
      
        datafusion-bio-functions
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#dependency-pinning">
<span class="md-ellipsis">
      
        Dependency pinning
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#io-pipeline-polars-io-plugin">
<span class="md-ellipsis">
      
        I/O Pipeline &amp; Polars IO Plugin
      
    </span>
</a>
<nav aria-label="I/O Pipeline &amp; Polars IO Plugin" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#overview">
<span class="md-ellipsis">
      
        Overview
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-by-step">
<span class="md-ellipsis">
      
        Step-by-step
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#the-io-plugin-callback-_overlap_source">
<span class="md-ellipsis">
      
        The IO plugin callback (_overlap_source)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#predicate-pushdown">
<span class="md-ellipsis">
      
        Predicate pushdown
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#projection-pushdown">
<span class="md-ellipsis">
      
        Projection pushdown
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#limit-pushdown">
<span class="md-ellipsis">
      
        Limit pushdown
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#streaming-execution">
<span class="md-ellipsis">
      
        Streaming execution
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#gff-special-handling">
<span class="md-ellipsis">
      
        GFF special handling
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#polars-integration">
<span class="md-ellipsis">
      
        Polars Integration
      
    </span>
</a>
<nav aria-label="Polars Integration" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#architecture">
<span class="md-ellipsis">
      
        Architecture
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#how-it-works">
<span class="md-ellipsis">
      
        How It Works
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#performance-benefits">
<span class="md-ellipsis">
      
        Performance Benefits
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#requirements">
<span class="md-ellipsis">
      
        Requirements
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#batch-size-configuration">
<span class="md-ellipsis">
      
        Batch Size Configuration
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example">
<span class="md-ellipsis">
      
        Example
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#metadata-flow-polars-arrow">
<span class="md-ellipsis">
      
        Metadata Flow: Polars ‚Üî Arrow
      
    </span>
</a>
<nav aria-label="Metadata Flow: Polars ‚Üî Arrow" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#overview_1">
<span class="md-ellipsis">
      
        Overview
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#arrow-side-metadata-datafusionrust">
<span class="md-ellipsis">
      
        Arrow-side metadata (DataFusion/Rust)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#polars-side-metadata-python">
<span class="md-ellipsis">
      
        Polars-side metadata (Python)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#read-path-arrow-polars">
<span class="md-ellipsis">
      
        Read path: Arrow ‚Üí Polars
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#write-path-polars-arrow">
<span class="md-ellipsis">
      
        Write path: Polars ‚Üí Arrow
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#metadata-preservation">
<span class="md-ellipsis">
      
        Metadata preservation
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#registered-table-metadata">
<span class="md-ellipsis">
      
        Registered table metadata
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#coordinate-system-internals">
<span class="md-ellipsis">
      
        Coordinate System Internals
      
    </span>
</a>
<nav aria-label="Coordinate System Internals" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#end-to-end-flow">
<span class="md-ellipsis">
      
        End-to-end flow
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#how-it-works_1">
<span class="md-ellipsis">
      
        How it works
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#storage-locations">
<span class="md-ellipsis">
      
        Storage locations
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#session-parameters">
<span class="md-ellipsis">
      
        Session parameters
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#format-defaults">
<span class="md-ellipsis">
      
        Format defaults
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#range-operation-algorithm">
<span class="md-ellipsis">
      
        Range Operation Algorithm
      
    </span>
</a>
<nav aria-label="Range Operation Algorithm" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#out-of-core-streaming-processing">
<span class="md-ellipsis">
      
        Out-of-core (streaming) processing
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#parallelization">
<span class="md-ellipsis">
      
        Parallelization
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#comparison-with-existing-tools">
<span class="md-ellipsis">
      
        Comparison with Existing Tools
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#datafusion-extension-points">
<span class="md-ellipsis">
      
        DataFusion Extension Points
      
    </span>
</a>
<nav aria-label="DataFusion Extension Points" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#physicaloptimizerrule-for-interval-join-rewriting">
<span class="md-ellipsis">
      
        PhysicalOptimizerRule for interval join rewriting
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tableprovider-udtf-for-specialized-operations">
<span class="md-ellipsis">
      
        TableProvider + UDTF for specialized operations
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#predicate-projection-pushdown-examples">
<span class="md-ellipsis">
      
        Predicate &amp; Projection Pushdown Examples
      
    </span>
</a>
<nav aria-label="Predicate &amp; Projection Pushdown Examples" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#record-level-filter-pushdown">
<span class="md-ellipsis">
      
        Record-level filter pushdown
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#projection-pushdown_1">
<span class="md-ellipsis">
      
        Projection pushdown
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inspecting-the-execution-plan">
<span class="md-ellipsis">
      
        Inspecting the execution plan
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#building-development">
<span class="md-ellipsis">
      
        Building &amp; Development
      
    </span>
</a>
<nav aria-label="Building &amp; Development" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#building-from-source">
<span class="md-ellipsis">
      
        Building from source
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#running-tests">
<span class="md-ellipsis">
      
        Running tests
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#building-documentation">
<span class="md-ellipsis">
      
        Building documentation
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rust-compilation-check">
<span class="md-ellipsis">
      
        Rust compilation check
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../contact/">
<span class="md-ellipsis">
    
  
    üì° Contact
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../quickstart/">
<span class="md-ellipsis">
    
  
    üèÉüèº‚Äç‚ôÇÔ∏è Quick start
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../features/">
<span class="md-ellipsis">
    
  
    üî®Features
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../notebooks/tutorial/">
<span class="md-ellipsis">
    
  
    üìöTutorial
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api/">
<span class="md-ellipsis">
    
  
    ‚öôÔ∏è API reference
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../faq/">
<span class="md-ellipsis">
    
  
    ‚ùì FAQ
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../supplement/">
<span class="md-ellipsis">
    
  
    üöÄ Performance
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    
  
    üõ†Ô∏è Developers guide
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    
  
    üõ†Ô∏è Developers guide
  

    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#architecture-overview">
<span class="md-ellipsis">
      
        Architecture Overview
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#upstream-repositories">
<span class="md-ellipsis">
      
        Upstream Repositories
      
    </span>
</a>
<nav aria-label="Upstream Repositories" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#datafusion-bio-formats">
<span class="md-ellipsis">
      
        datafusion-bio-formats
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#datafusion-bio-functions">
<span class="md-ellipsis">
      
        datafusion-bio-functions
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#dependency-pinning">
<span class="md-ellipsis">
      
        Dependency pinning
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#io-pipeline-polars-io-plugin">
<span class="md-ellipsis">
      
        I/O Pipeline &amp; Polars IO Plugin
      
    </span>
</a>
<nav aria-label="I/O Pipeline &amp; Polars IO Plugin" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#overview">
<span class="md-ellipsis">
      
        Overview
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-by-step">
<span class="md-ellipsis">
      
        Step-by-step
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#the-io-plugin-callback-_overlap_source">
<span class="md-ellipsis">
      
        The IO plugin callback (_overlap_source)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#predicate-pushdown">
<span class="md-ellipsis">
      
        Predicate pushdown
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#projection-pushdown">
<span class="md-ellipsis">
      
        Projection pushdown
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#limit-pushdown">
<span class="md-ellipsis">
      
        Limit pushdown
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#streaming-execution">
<span class="md-ellipsis">
      
        Streaming execution
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#gff-special-handling">
<span class="md-ellipsis">
      
        GFF special handling
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#polars-integration">
<span class="md-ellipsis">
      
        Polars Integration
      
    </span>
</a>
<nav aria-label="Polars Integration" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#architecture">
<span class="md-ellipsis">
      
        Architecture
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#how-it-works">
<span class="md-ellipsis">
      
        How It Works
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#performance-benefits">
<span class="md-ellipsis">
      
        Performance Benefits
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#requirements">
<span class="md-ellipsis">
      
        Requirements
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#batch-size-configuration">
<span class="md-ellipsis">
      
        Batch Size Configuration
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example">
<span class="md-ellipsis">
      
        Example
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#metadata-flow-polars-arrow">
<span class="md-ellipsis">
      
        Metadata Flow: Polars ‚Üî Arrow
      
    </span>
</a>
<nav aria-label="Metadata Flow: Polars ‚Üî Arrow" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#overview_1">
<span class="md-ellipsis">
      
        Overview
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#arrow-side-metadata-datafusionrust">
<span class="md-ellipsis">
      
        Arrow-side metadata (DataFusion/Rust)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#polars-side-metadata-python">
<span class="md-ellipsis">
      
        Polars-side metadata (Python)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#read-path-arrow-polars">
<span class="md-ellipsis">
      
        Read path: Arrow ‚Üí Polars
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#write-path-polars-arrow">
<span class="md-ellipsis">
      
        Write path: Polars ‚Üí Arrow
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#metadata-preservation">
<span class="md-ellipsis">
      
        Metadata preservation
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#registered-table-metadata">
<span class="md-ellipsis">
      
        Registered table metadata
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#coordinate-system-internals">
<span class="md-ellipsis">
      
        Coordinate System Internals
      
    </span>
</a>
<nav aria-label="Coordinate System Internals" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#end-to-end-flow">
<span class="md-ellipsis">
      
        End-to-end flow
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#how-it-works_1">
<span class="md-ellipsis">
      
        How it works
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#storage-locations">
<span class="md-ellipsis">
      
        Storage locations
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#session-parameters">
<span class="md-ellipsis">
      
        Session parameters
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#format-defaults">
<span class="md-ellipsis">
      
        Format defaults
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#range-operation-algorithm">
<span class="md-ellipsis">
      
        Range Operation Algorithm
      
    </span>
</a>
<nav aria-label="Range Operation Algorithm" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#out-of-core-streaming-processing">
<span class="md-ellipsis">
      
        Out-of-core (streaming) processing
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#parallelization">
<span class="md-ellipsis">
      
        Parallelization
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#comparison-with-existing-tools">
<span class="md-ellipsis">
      
        Comparison with Existing Tools
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#datafusion-extension-points">
<span class="md-ellipsis">
      
        DataFusion Extension Points
      
    </span>
</a>
<nav aria-label="DataFusion Extension Points" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#physicaloptimizerrule-for-interval-join-rewriting">
<span class="md-ellipsis">
      
        PhysicalOptimizerRule for interval join rewriting
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tableprovider-udtf-for-specialized-operations">
<span class="md-ellipsis">
      
        TableProvider + UDTF for specialized operations
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#predicate-projection-pushdown-examples">
<span class="md-ellipsis">
      
        Predicate &amp; Projection Pushdown Examples
      
    </span>
</a>
<nav aria-label="Predicate &amp; Projection Pushdown Examples" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#record-level-filter-pushdown">
<span class="md-ellipsis">
      
        Record-level filter pushdown
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#projection-pushdown_1">
<span class="md-ellipsis">
      
        Projection pushdown
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inspecting-the-execution-plan">
<span class="md-ellipsis">
      
        Inspecting the execution plan
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#building-development">
<span class="md-ellipsis">
      
        Building &amp; Development
      
    </span>
</a>
<nav aria-label="Building &amp; Development" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#building-from-source">
<span class="md-ellipsis">
      
        Building from source
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#running-tests">
<span class="md-ellipsis">
      
        Running tests
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#building-documentation">
<span class="md-ellipsis">
      
        Building documentation
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rust-compilation-check">
<span class="md-ellipsis">
      
        Rust compilation check
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../contact/">
<span class="md-ellipsis">
    
  
    üì° Contact
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_10" type="checkbox"/>
<label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
<span class="md-ellipsis">
    
  
    üìñ Blog
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_10_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_10">
<span class="md-nav__icon md-icon"></span>
            
  
    üìñ Blog
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../blog/">
<span class="md-ellipsis">
    
  
    Blog
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_10_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_10_2" id="__nav_10_2_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Categories
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_10_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_10_2">
<span class="md-nav__icon md-icon"></span>
            
  
    Categories
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../blog/category/benchmarks/">
<span class="md-ellipsis">
    
  
    benchmarks
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../blog/category/file-formats/">
<span class="md-ellipsis">
    
  
    file formats
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../blog/category/performance/">
<span class="md-ellipsis">
    
  
    performance
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../blog/category/releases/">
<span class="md-ellipsis">
    
  
    releases
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#architecture-overview">
<span class="md-ellipsis">
      
        Architecture Overview
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#upstream-repositories">
<span class="md-ellipsis">
      
        Upstream Repositories
      
    </span>
</a>
<nav aria-label="Upstream Repositories" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#datafusion-bio-formats">
<span class="md-ellipsis">
      
        datafusion-bio-formats
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#datafusion-bio-functions">
<span class="md-ellipsis">
      
        datafusion-bio-functions
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#dependency-pinning">
<span class="md-ellipsis">
      
        Dependency pinning
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#io-pipeline-polars-io-plugin">
<span class="md-ellipsis">
      
        I/O Pipeline &amp; Polars IO Plugin
      
    </span>
</a>
<nav aria-label="I/O Pipeline &amp; Polars IO Plugin" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#overview">
<span class="md-ellipsis">
      
        Overview
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-by-step">
<span class="md-ellipsis">
      
        Step-by-step
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#the-io-plugin-callback-_overlap_source">
<span class="md-ellipsis">
      
        The IO plugin callback (_overlap_source)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#predicate-pushdown">
<span class="md-ellipsis">
      
        Predicate pushdown
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#projection-pushdown">
<span class="md-ellipsis">
      
        Projection pushdown
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#limit-pushdown">
<span class="md-ellipsis">
      
        Limit pushdown
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#streaming-execution">
<span class="md-ellipsis">
      
        Streaming execution
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#gff-special-handling">
<span class="md-ellipsis">
      
        GFF special handling
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#polars-integration">
<span class="md-ellipsis">
      
        Polars Integration
      
    </span>
</a>
<nav aria-label="Polars Integration" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#architecture">
<span class="md-ellipsis">
      
        Architecture
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#how-it-works">
<span class="md-ellipsis">
      
        How It Works
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#performance-benefits">
<span class="md-ellipsis">
      
        Performance Benefits
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#requirements">
<span class="md-ellipsis">
      
        Requirements
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#batch-size-configuration">
<span class="md-ellipsis">
      
        Batch Size Configuration
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example">
<span class="md-ellipsis">
      
        Example
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#metadata-flow-polars-arrow">
<span class="md-ellipsis">
      
        Metadata Flow: Polars ‚Üî Arrow
      
    </span>
</a>
<nav aria-label="Metadata Flow: Polars ‚Üî Arrow" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#overview_1">
<span class="md-ellipsis">
      
        Overview
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#arrow-side-metadata-datafusionrust">
<span class="md-ellipsis">
      
        Arrow-side metadata (DataFusion/Rust)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#polars-side-metadata-python">
<span class="md-ellipsis">
      
        Polars-side metadata (Python)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#read-path-arrow-polars">
<span class="md-ellipsis">
      
        Read path: Arrow ‚Üí Polars
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#write-path-polars-arrow">
<span class="md-ellipsis">
      
        Write path: Polars ‚Üí Arrow
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#metadata-preservation">
<span class="md-ellipsis">
      
        Metadata preservation
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#registered-table-metadata">
<span class="md-ellipsis">
      
        Registered table metadata
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#coordinate-system-internals">
<span class="md-ellipsis">
      
        Coordinate System Internals
      
    </span>
</a>
<nav aria-label="Coordinate System Internals" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#end-to-end-flow">
<span class="md-ellipsis">
      
        End-to-end flow
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#how-it-works_1">
<span class="md-ellipsis">
      
        How it works
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#storage-locations">
<span class="md-ellipsis">
      
        Storage locations
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#session-parameters">
<span class="md-ellipsis">
      
        Session parameters
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#format-defaults">
<span class="md-ellipsis">
      
        Format defaults
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#range-operation-algorithm">
<span class="md-ellipsis">
      
        Range Operation Algorithm
      
    </span>
</a>
<nav aria-label="Range Operation Algorithm" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#out-of-core-streaming-processing">
<span class="md-ellipsis">
      
        Out-of-core (streaming) processing
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#parallelization">
<span class="md-ellipsis">
      
        Parallelization
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#comparison-with-existing-tools">
<span class="md-ellipsis">
      
        Comparison with Existing Tools
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#datafusion-extension-points">
<span class="md-ellipsis">
      
        DataFusion Extension Points
      
    </span>
</a>
<nav aria-label="DataFusion Extension Points" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#physicaloptimizerrule-for-interval-join-rewriting">
<span class="md-ellipsis">
      
        PhysicalOptimizerRule for interval join rewriting
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#tableprovider-udtf-for-specialized-operations">
<span class="md-ellipsis">
      
        TableProvider + UDTF for specialized operations
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#predicate-projection-pushdown-examples">
<span class="md-ellipsis">
      
        Predicate &amp; Projection Pushdown Examples
      
    </span>
</a>
<nav aria-label="Predicate &amp; Projection Pushdown Examples" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#record-level-filter-pushdown">
<span class="md-ellipsis">
      
        Record-level filter pushdown
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#projection-pushdown_1">
<span class="md-ellipsis">
      
        Projection pushdown
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inspecting-the-execution-plan">
<span class="md-ellipsis">
      
        Inspecting the execution plan
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#building-development">
<span class="md-ellipsis">
      
        Building &amp; Development
      
    </span>
</a>
<nav aria-label="Building &amp; Development" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#building-from-source">
<span class="md-ellipsis">
      
        Building from source
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#running-tests">
<span class="md-ellipsis">
      
        Running tests
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#building-documentation">
<span class="md-ellipsis">
      
        Building documentation
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rust-compilation-check">
<span class="md-ellipsis">
      
        Rust compilation check
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/biodatageeks/polars-bio/edit/master/docs/developers.md" rel="edit" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"></path></svg>
</a>
<h1>üõ†Ô∏è Developers guide</h1>
<h2 id="architecture-overview">Architecture Overview<a class="headerlink" href="#architecture-overview" title="Permanent link"></a></h2>
<p>polars-bio is a Python library for high-performance genomic data processing. It combines a Python API layer with a Rust-based execution engine powered by Apache DataFusion, extended with bioinformatics-specific capabilities through upstream <code>datafusion-bio-*</code> crates.</p>
<pre class="mermaid"><code>flowchart TB
    subgraph Python["Python API Layer"]
        direction LR
        io["I/O Operations&lt;br/&gt;(scan/read/write)"]
        range["Range Operations&lt;br/&gt;(overlap, nearest, ...)"]
        pileup["Pileup Operations&lt;br/&gt;(depth)"]
        sql["SQL API"]
    end

    subgraph PyO3["PyO3 Rust Bindings"]
        direction LR
        py_register["py_register_table()"]
        py_read["py_read_table() / py_read_sql()"]
        py_pileup["py_pileup_depth()"]
    end

    subgraph DataFusion["Apache DataFusion Engine"]
        direction LR
        ctx["SessionContext"]
        optimizer["Physical Optimizer"]
        exec["Execution Engine"]
    end

    subgraph Upstream["Upstream Crates"]
        direction LR
        formats["datafusion-bio-formats&lt;br/&gt;(9 sub-crates)"]
        functions["datafusion-bio-functions&lt;br/&gt;(ranges + pileup)"]
    end

    subgraph Storage["Data Sources"]
        direction LR
        local["Local Files"]
        cloud["Cloud Storage&lt;br/&gt;(S3, GCS, Azure)"]
    end

    Python --&gt; PyO3
    PyO3 --&gt; DataFusion
    DataFusion --&gt; Upstream
    Upstream --&gt; Storage</code></pre>
<p>The key design principles are:</p>
<ul>
<li><strong>Zero-copy data exchange</strong> between Python (Polars/Pandas) and Rust via the Arrow C Data Interface</li>
<li><strong>Predicate and projection pushdown</strong> through DataFusion's optimizer to minimize I/O</li>
<li><strong>Streaming execution</strong> for out-of-core processing of datasets larger than memory</li>
<li><strong>Parallel execution</strong> via DataFusion's partitioned execution model</li>
</ul>
<h2 id="upstream-repositories">Upstream Repositories<a class="headerlink" href="#upstream-repositories" title="Permanent link"></a></h2>
<p>polars-bio relies on two upstream repository families that provide the DataFusion extensions for bioinformatics workloads. These are pinned as git dependencies in <code>Cargo.toml</code>.</p>
<h3 id="datafusion-bio-formats">datafusion-bio-formats<a class="headerlink" href="#datafusion-bio-formats" title="Permanent link"></a></h3>
<p><strong>Repository</strong>: <a href="https://github.com/biodatageeks/datafusion-bio-formats">github.com/biodatageeks/datafusion-bio-formats</a></p>
<p>Provides DataFusion <code>TableProvider</code> implementations for bioinformatics file formats, using <a href="https://github.com/zaeleus/noodles">noodles</a> for low-level format I/O.</p>
<table>
<thead>
<tr>
<th>Crate</th>
<th>Format</th>
<th>Features</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>datafusion-bio-format-bam</code></td>
<td>BAM</td>
<td>Indexed reads (BAI/CSI), predicate &amp; projection pushdown, parallel partitioning</td>
</tr>
<tr>
<td><code>datafusion-bio-format-cram</code></td>
<td>CRAM</td>
<td>Indexed reads (CRAI), predicate &amp; projection pushdown, reference-based compression</td>
</tr>
<tr>
<td><code>datafusion-bio-format-vcf</code></td>
<td>VCF</td>
<td>Indexed reads (TBI/CSI), predicate &amp; projection pushdown, INFO/FORMAT field extraction</td>
</tr>
<tr>
<td><code>datafusion-bio-format-gff</code></td>
<td>GFF3</td>
<td>Indexed reads (TBI/CSI), predicate &amp; projection pushdown, attribute field extraction</td>
</tr>
<tr>
<td><code>datafusion-bio-format-bed</code></td>
<td>BED</td>
<td>Single-threaded reads, limit pushdown</td>
</tr>
<tr>
<td><code>datafusion-bio-format-fastq</code></td>
<td>FASTQ</td>
<td>GZI-indexed parallel BGZF decoding, limit pushdown</td>
</tr>
<tr>
<td><code>datafusion-bio-format-fasta</code></td>
<td>FASTA</td>
<td>Single-threaded reads, limit pushdown</td>
</tr>
<tr>
<td><code>datafusion-bio-format-pairs</code></td>
<td>Pairs</td>
<td>Indexed reads (TBI/CSI), predicate &amp; projection pushdown</td>
</tr>
<tr>
<td><code>datafusion-bio-format-core</code></td>
<td>Core</td>
<td>Shared utilities, coordinate system metadata, OpenDAL cloud storage integration</td>
</tr>
</tbody>
</table>
<h3 id="datafusion-bio-functions">datafusion-bio-functions<a class="headerlink" href="#datafusion-bio-functions" title="Permanent link"></a></h3>
<p><strong>Repository</strong>: <a href="https://github.com/biodatageeks/datafusion-bio-functions">github.com/biodatageeks/datafusion-bio-functions</a></p>
<p>Provides DataFusion extensions for genomic range operations and pileup computation.</p>
<table>
<thead>
<tr>
<th>Crate</th>
<th>Purpose</th>
<th>Mechanism</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>datafusion-bio-function-ranges</code></td>
<td>Overlap, nearest, coverage, count-overlaps</td>
<td><code>PhysicalOptimizerRule</code> for interval join rewriting + UDTF for coverage/count-overlaps</td>
</tr>
<tr>
<td><code>datafusion-bio-function-pileup</code></td>
<td>Per-base read depth (pileup)</td>
<td>UDTF registered as <code>depth()</code> in SQL</td>
</tr>
</tbody>
</table>
<h3 id="dependency-pinning">Dependency pinning<a class="headerlink" href="#dependency-pinning" title="Permanent link"></a></h3>
<p>Both repositories are pinned to specific git revisions in <code>Cargo.toml</code>:</p>
<div class="language-toml highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="c1"># Format crates (all pinned to the same revision)</span>
</span><span id="__span-0-2"><a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="n">datafusion-bio-format-vcf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">"https://github.com/biodatageeks/datafusion-bio-formats.git"</span><span class="p">,</span><span class="w"> </span><span class="n">rev</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">"..."</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-0-3"><a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="n">datafusion-bio-format-bam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">"https://github.com/biodatageeks/datafusion-bio-formats.git"</span><span class="p">,</span><span class="w"> </span><span class="n">rev</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">"..."</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-0-4"><a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="c1"># ... (9 sub-crates total)</span>
</span><span id="__span-0-5"><a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a>
</span><span id="__span-0-6"><a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="c1"># Function crates</span>
</span><span id="__span-0-7"><a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="n">datafusion-bio-function-ranges</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">"https://github.com/biodatageeks/datafusion-bio-functions.git"</span><span class="p">,</span><span class="w"> </span><span class="n">rev</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">"..."</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-0-8"><a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="n">datafusion-bio-function-pileup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">"https://github.com/biodatageeks/datafusion-bio-functions.git"</span><span class="p">,</span><span class="w"> </span><span class="n">rev</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w"> </span><span class="n">default-features</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>datafusion-bio-function-pileup</code> uses <code>default-features = false</code> to avoid a duplicate BAM dependency conflict with <code>datafusion-bio-format-bam</code>.</p>
</div>
<h2 id="io-pipeline-polars-io-plugin">I/O Pipeline &amp; Polars IO Plugin<a class="headerlink" href="#io-pipeline-polars-io-plugin" title="Permanent link"></a></h2>
<p>polars-bio uses the <a href="https://docs.pola.rs/api/python/stable/reference/io_plugins.html">Polars IO plugin</a> mechanism (<code>register_io_source</code>) to bridge between DataFusion's streaming execution and Polars' lazy evaluation. This section documents the end-to-end I/O pipeline and the pushdown optimizations applied at each stage.</p>
<h3 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link"></a></h3>
<p>Every <code>scan_*()</code> / <code>read_*()</code> call flows through the same pipeline:</p>
<pre class="mermaid"><code>flowchart TB
    subgraph User["User API"]
        scan["scan_bam() / scan_vcf() / scan_gff() / ..."]
    end

    subgraph ReadFile["_read_file()"]
        register["1. py_register_table()&lt;br/&gt;Register DataFusion TableProvider"]
        schema["2. py_get_table_schema()&lt;br/&gt;Extract Arrow schema + metadata"]
        extract["3. extract_all_schema_metadata()&lt;br/&gt;Parse bio.* metadata"]
        lazy["4. _lazy_scan()&lt;br/&gt;Create Polars LazyFrame via IO plugin"]
        meta["5. set_coordinate_system() +&lt;br/&gt;set_source_metadata()"]
    end

    subgraph IOPlugin["Polars IO Plugin (_overlap_source callback)"]
        direction TB
        predicate["Predicate pushdown"]
        projection["Projection pushdown"]
        limit["Limit pushdown"]
        stream["execute_stream()&lt;br/&gt;Yield Arrow batches"]
        safety["Safety net:&lt;br/&gt;client-side filter/select"]
    end

    subgraph DataFusion["DataFusion Engine"]
        tp["TableProvider&lt;br/&gt;(BamTableProvider, VcfTableProvider, ...)"]
        idx["Index-based partition pruning&lt;br/&gt;(BAI/CSI/TBI/CRAI)"]
        record["Record-level filtering"]
        proj["Column-level skip"]
    end

    scan --&gt; ReadFile
    ReadFile --&gt; IOPlugin
    IOPlugin --&gt; DataFusion</code></pre>
<h3 id="step-by-step">Step-by-step<a class="headerlink" href="#step-by-step" title="Permanent link"></a></h3>
<p><strong>1. Registration</strong> ‚Äî <code>py_register_table()</code> (Rust/PyO3) creates a DataFusion <code>TableProvider</code> for the given format (e.g., <code>BamTableProvider</code>, <code>VcfTableProvider</code>). The provider handles file opening, index discovery, schema inference, and partition planning.</p>
<p><strong>2. Schema extraction</strong> ‚Äî <code>py_get_table_schema()</code> returns the Arrow schema with all <code>bio.*</code> metadata without reading any data. This is used to derive the Polars schema for the IO plugin.</p>
<p><strong>3. Metadata parsing</strong> ‚Äî <code>extract_all_schema_metadata()</code> decodes Arrow metadata into format-specific structures (VCF headers, sample names, etc.). See <a href="#metadata-flow-polars-arrow">Metadata Flow</a> for details.</p>
<p><strong>4. IO plugin registration</strong> ‚Äî <code>_lazy_scan()</code> calls Polars' <code>register_io_source()</code>, providing:</p>
<ul>
<li>A <strong>schema</strong> (dict of column name ‚Üí Polars dtype, derived from the Arrow schema)</li>
<li>A <strong>callback function</strong> (<code>_overlap_source</code>) that receives pushdown hints from Polars' query optimizer</li>
</ul>
<p><strong>5. Metadata attachment</strong> ‚Äî Coordinate system and source metadata are set on the returned LazyFrame via <code>config_meta</code>.</p>
<h3 id="the-io-plugin-callback-_overlap_source">The IO plugin callback (<code>_overlap_source</code>)<a class="headerlink" href="#the-io-plugin-callback-_overlap_source" title="Permanent link"></a></h3>
<p>When Polars collects the LazyFrame (<code>.collect()</code> or streaming), it calls the registered <code>_overlap_source</code> callback with four parameters provided by the Polars engine:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">_overlap_source</span><span class="p">(</span>
</span><span id="__span-1-2"><a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a>    <span class="n">with_columns</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">Expr</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>   <span class="c1"># Requested columns (projection)</span>
</span><span id="__span-1-3"><a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a>    <span class="n">predicate</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">Expr</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>       <span class="c1"># Filter expression</span>
</span><span id="__span-1-4"><a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a>    <span class="n">n_rows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>              <span class="c1"># Row limit</span>
</span><span id="__span-1-5"><a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a>    <span class="n">_batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>         <span class="c1"># Batch size hint</span>
</span><span id="__span-1-6"><a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
</span></code></pre></div>
<p>The callback implements three pushdown optimizations, falling back to client-side evaluation when pushdown fails:</p>
<h3 id="predicate-pushdown">Predicate pushdown<a class="headerlink" href="#predicate-pushdown" title="Permanent link"></a></h3>
<p>Predicate pushdown translates Polars filter expressions into DataFusion predicates so that filtering happens inside the DataFusion execution engine ‚Äî before data reaches Python.</p>
<p>The translation has two levels:</p>
<p><strong>Level 1: Index-based region pruning</strong> ‚Äî When a genomic region filter is present (e.g., <code>pl.col("chrom") == "chr1"</code>) and an index file exists, the upstream <code>TableProvider</code> uses the index to skip irrelevant file regions entirely. This is handled automatically by DataFusion's plan optimization ‚Äî the predicate in the DataFusion <code>DataFrame.filter()</code> is propagated to the <code>TableProvider::scan()</code> method which performs partition pruning.</p>
<p><strong>Level 2: Record-level filtering</strong> ‚Äî For non-genomic predicates (e.g., <code>pl.col("mapping_quality") &gt;= 30</code>), the filter is evaluated per-record during parsing, before Arrow RecordBatch construction.</p>
<p>The translation pipeline is:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a>Polars Expr                          (pl.col("chrom") == "chr1")
</span><span id="__span-2-2"><a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a>    ‚Üì translate_predicate()
</span><span id="__span-2-3"><a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a>DataFusion Expr                      (col("chrom") == lit("chr1"))
</span><span id="__span-2-4"><a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a>    ‚Üì datafusion_expr_to_sql()
</span><span id="__span-2-5"><a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a>SQL string                           ("chrom = 'chr1'")
</span><span id="__span-2-6"><a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a>    ‚Üì query_df.parse_sql_expr()
</span><span id="__span-2-7"><a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a>Binding-compatible DataFusion Expr   (same PyO3 compilation unit)
</span><span id="__span-2-8"><a href="#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a>    ‚Üì query_df.filter()
</span><span id="__span-2-9"><a href="#__codelineno-2-9" id="__codelineno-2-9" name="__codelineno-2-9"></a>DataFusion DataFrame with predicate
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Why the SQL roundtrip?</p>
<p>The <code>polars_bio</code> Rust crate and the <code>pip install datafusion</code> Python package are separate PyO3 compilation units. Their <code>Expr</code> types are <strong>not interchangeable</strong> at the Python level. The bridge goes through <code>parse_sql_expr()</code>, which creates an <code>Expr</code> from the <em>same</em> compilation unit as the <code>DataFrame</code>, avoiding type mismatches.</p>
</div>
<p><strong>Format-aware validation</strong> ‚Äî The predicate translator knows the column types for each format and validates operator compatibility:</p>
<table>
<thead>
<tr>
<th>Column type</th>
<th>Supported operators</th>
</tr>
</thead>
<tbody>
<tr>
<td>String (<code>chrom</code>, <code>name</code>, ...)</td>
<td><code>==</code>, <code>!=</code>, <code>IN</code>, <code>NOT IN</code></td>
</tr>
<tr>
<td>Numeric (<code>start</code>, <code>end</code>, <code>mapping_quality</code>, ...)</td>
<td><code>==</code>, <code>!=</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>BETWEEN</code>, <code>IN</code>, <code>NOT IN</code></td>
</tr>
<tr>
<td>Unknown (BAM tags, VCF INFO fields, GFF attributes)</td>
<td>All ‚Äî DataFusion type-checks at execution</td>
</tr>
<tr>
<td>Compound</td>
<td><code>AND</code> combinations of the above</td>
</tr>
</tbody>
</table>
<p><strong>Safety net</strong> ‚Äî If translation fails (unsupported expression, type error), the callback logs a warning and applies the filter client-side on each batch after streaming:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="k">if</span> <span class="n">predicate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">datafusion_predicate_applied</span><span class="p">:</span>
</span><span id="__span-3-2"><a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a>    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span>  <span class="c1"># client-side fallback</span>
</span></code></pre></div>
<h3 id="projection-pushdown">Projection pushdown<a class="headerlink" href="#projection-pushdown" title="Permanent link"></a></h3>
<p>When Polars' optimizer determines only a subset of columns is needed (e.g., <code>.select(["name", "chrom"])</code>), the <code>with_columns</code> parameter carries the requested column names. The callback pushes this down to DataFusion:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="n">select_exprs</span> <span class="o">=</span> <span class="p">[</span><span class="n">query_df</span><span class="o">.</span><span class="n">parse_sql_expr</span><span class="p">(</span><span class="sa">f</span><span class="s1">'"</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">"'</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">requested_cols</span><span class="p">]</span>
</span><span id="__span-4-2"><a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="n">query_df</span> <span class="o">=</span> <span class="n">query_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="o">*</span><span class="n">select_exprs</span><span class="p">)</span>
</span></code></pre></div>
<p>This propagates through the DataFusion plan to the <code>TableProvider</code>, where <strong>parsing-level projection</strong> skips fields during record decoding:</p>
<ul>
<li><strong>BAM</strong>: Unprojected fields (sequence, quality scores, CIGAR, tags) are not decoded</li>
<li><strong>VCF</strong>: Unprojected INFO/FORMAT fields are not parsed</li>
<li><strong>GFF</strong>: Attribute fields are only parsed if requested (GFF re-registers the table with <code>attr_fields</code> when specific attribute columns are projected)</li>
</ul>
<p><strong>Safety net</strong> ‚Äî If DataFusion projection fails, client-side select is applied:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="k">if</span> <span class="n">with_columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">datafusion_projection_applied</span><span class="p">:</span>
</span><span id="__span-5-2"><a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a>    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">with_columns</span><span class="p">)</span>  <span class="c1"># client-side fallback</span>
</span></code></pre></div>
<h3 id="limit-pushdown">Limit pushdown<a class="headerlink" href="#limit-pushdown" title="Permanent link"></a></h3>
<p>When a <code>.head(n)</code> or <code>.limit(n)</code> is applied, Polars passes <code>n_rows</code> to the callback. This is pushed to DataFusion:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="k">if</span> <span class="n">n_rows</span> <span class="ow">and</span> <span class="n">n_rows</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-6-2"><a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a>    <span class="n">query_df</span> <span class="o">=</span> <span class="n">query_df</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n_rows</span><span class="p">))</span>
</span></code></pre></div>
<p>DataFusion propagates the limit to the <code>TableProvider</code>, which stops reading after enough records are produced. An additional client-side limit guard tracks remaining rows across batches.</p>
<h3 id="streaming-execution">Streaming execution<a class="headerlink" href="#streaming-execution" title="Permanent link"></a></h3>
<p>After all pushdowns are applied, the callback executes the query as a stream of Arrow RecordBatches:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="n">df_stream</span> <span class="o">=</span> <span class="n">query_df</span><span class="o">.</span><span class="n">execute_stream</span><span class="p">()</span>
</span><span id="__span-7-2"><a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">df_stream</span><span class="p">:</span>
</span><span id="__span-7-3"><a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a>    <span class="n">out</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">to_pyarrow</span><span class="p">())</span>
</span><span id="__span-7-4"><a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a>    <span class="c1"># Apply client-side fallbacks if needed</span>
</span><span id="__span-7-5"><a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a>    <span class="k">yield</span> <span class="n">out</span>
</span></code></pre></div>
<p>Each yielded <code>pl.DataFrame</code> batch becomes part of the Polars LazyFrame execution graph. Polars can then apply further operations (joins, aggregations, sinks) on the stream.</p>
<h3 id="gff-special-handling">GFF special handling<a class="headerlink" href="#gff-special-handling" title="Permanent link"></a></h3>
<p>GFF is the only format where projection affects table registration. GFF files have a semi-structured <code>attributes</code> column containing <code>key=value</code> pairs. When specific attribute columns are projected (e.g., <code>gene_id</code>, <code>transcript_id</code>), the callback <strong>re-registers the table</strong> with those <code>attr_fields</code> so the TableProvider parses them into individual columns:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-8-1"><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="k">if</span> <span class="n">input_format</span> <span class="o">==</span> <span class="n">InputFormat</span><span class="o">.</span><span class="n">Gff</span> <span class="ow">and</span> <span class="n">attr_fields</span><span class="p">:</span>
</span><span id="__span-8-2"><a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a>    <span class="n">gff_opts</span> <span class="o">=</span> <span class="n">GffReadOptions</span><span class="p">(</span><span class="n">attr_fields</span><span class="o">=</span><span class="n">attr_fields</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</span><span id="__span-8-3"><a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a>    <span class="n">table_obj</span> <span class="o">=</span> <span class="n">py_register_table</span><span class="p">(</span><span class="n">_ctx</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">InputFormat</span><span class="o">.</span><span class="n">Gff</span><span class="p">,</span> <span class="n">ropts</span><span class="p">)</span>
</span><span id="__span-8-4"><a href="#__codelineno-8-4" id="__codelineno-8-4" name="__codelineno-8-4"></a>    <span class="n">table_to_query</span> <span class="o">=</span> <span class="n">table_obj</span><span class="o">.</span><span class="n">name</span>
</span></code></pre></div>
<h2 id="polars-integration">Polars Integration<a class="headerlink" href="#polars-integration" title="Permanent link"></a></h2>
<p>polars-bio leverages deep integration with Polars through the <a href="https://arrow.apache.org/docs/format/CDataInterface.html">Arrow C Data Interface</a>, enabling high-performance zero-copy data exchange between Polars LazyFrames and the Rust-based genomic range operations engine.</p>
<h3 id="architecture">Architecture<a class="headerlink" href="#architecture" title="Permanent link"></a></h3>
<pre class="mermaid"><code>flowchart LR
    subgraph Python["Python Layer"]
        LF["Polars LazyFrame"]
        DF["Polars DataFrame"]
    end

    subgraph FFI["Arrow C Data Interface"]
        stream["Arrow C Stream&lt;br/&gt;(__arrow_c_stream__)"]
    end

    subgraph Rust["Rust Layer (polars-bio)"]
        reader["ArrowArrayStreamReader"]
        datafusion["DataFusion Engine"]
        range_ops["Range Operations&lt;br/&gt;(overlap, nearest, etc.)"]
    end

    LF --&gt; |"ArrowStreamExportable"| stream
    DF --&gt; |"to_arrow()"| stream
    stream --&gt; |"Zero-copy FFI"| reader
    reader --&gt; datafusion
    datafusion --&gt; range_ops</code></pre>
<h3 id="how-it-works">How It Works<a class="headerlink" href="#how-it-works" title="Permanent link"></a></h3>
<p>When you pass a Polars LazyFrame to range operations like <code>overlap()</code> or <code>nearest()</code>:</p>
<ol>
<li><strong>Stream Export</strong>: The LazyFrame exports itself as an Arrow C Stream via <code>collect_batches(lazy=True)._inner.__arrow_c_stream__()</code> (Polars &gt;= 1.37.0)</li>
<li><strong>Zero-Copy Transfer</strong>: The stream pointer is passed directly to Rust - no data copying or Python object conversion</li>
<li><strong>GIL-Free Execution</strong>: Once the stream is exported, all data processing happens in Rust without holding Python's GIL</li>
<li><strong>Streaming Execution</strong>: Data flows through DataFusion's streaming engine, processing batches on-demand</li>
</ol>
<h3 id="performance-benefits">Performance Benefits<a class="headerlink" href="#performance-benefits" title="Permanent link"></a></h3>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Previous Approach</th>
<th>Arrow C Stream</th>
</tr>
</thead>
<tbody>
<tr>
<td>GIL acquisition</td>
<td>Per batch</td>
<td>Once at export</td>
</tr>
<tr>
<td>Data conversion</td>
<td>Polars -&gt; PyArrow -&gt; Arrow</td>
<td>Direct FFI</td>
</tr>
<tr>
<td>Memory overhead</td>
<td>Python iterator objects</td>
<td>None</td>
</tr>
<tr>
<td>Batch processing</td>
<td>Python <code>__next__()</code> calls</td>
<td>Native Rust iteration</td>
</tr>
</tbody>
</table>
<h3 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permanent link"></a></h3>
<ul>
<li><strong>Polars &gt;= 1.37.0</strong> (required for <code>ArrowStreamExportable</code>)</li>
</ul>
<h3 id="batch-size-configuration">Batch Size Configuration<a class="headerlink" href="#batch-size-configuration" title="Permanent link"></a></h3>
<p>polars-bio automatically synchronizes the batch size between Polars streaming and DataFusion execution. When you set <code>datafusion.execution.batch_size</code>, Polars' <code>collect_batches()</code> will use the same chunk size:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-9-1"><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">polars_bio</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pb</span>
</span><span id="__span-9-2"><a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a>
</span><span id="__span-9-3"><a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="c1"># Set batch size for both Polars and DataFusion</span>
</span><span id="__span-9-4"><a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="n">pb</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">"datafusion.execution.batch_size"</span><span class="p">,</span> <span class="s2">"8192"</span><span class="p">)</span>
</span><span id="__span-9-5"><a href="#__codelineno-9-5" id="__codelineno-9-5" name="__codelineno-9-5"></a>
</span><span id="__span-9-6"><a href="#__codelineno-9-6" id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="c1"># Now LazyFrame streaming uses 8192-row batches</span>
</span><span id="__span-9-7"><a href="#__codelineno-9-7" id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="c1"># This ensures consistent memory usage and processing patterns</span>
</span></code></pre></div>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Effect</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>datafusion.execution.batch_size</code></td>
<td>Controls batch size for both Polars streaming export and DataFusion processing</td>
</tr>
<tr>
<td>Default</td>
<td>8192 rows (synchronized between Polars and DataFusion)</td>
</tr>
<tr>
<td><code>"65536"</code></td>
<td>Larger batches for high-throughput scenarios</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Matching batch sizes between Polars and DataFusion improves cache locality and reduces memory fragmentation when processing large datasets.</p>
</div>
<h3 id="example">Example<a class="headerlink" href="#example" title="Permanent link"></a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-10-1"><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">polars</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pl</span>
</span><span id="__span-10-2"><a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">polars_bio</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pb</span>
</span><span id="__span-10-3"><a href="#__codelineno-10-3" id="__codelineno-10-3" name="__codelineno-10-3"></a>
</span><span id="__span-10-4"><a href="#__codelineno-10-4" id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="c1"># Create a LazyFrame from a large file</span>
</span><span id="__span-10-5"><a href="#__codelineno-10-5" id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="n">lf1</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">scan_parquet</span><span class="p">(</span><span class="s2">"variants.parquet"</span><span class="p">)</span>
</span><span id="__span-10-6"><a href="#__codelineno-10-6" id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="n">lf2</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">scan_parquet</span><span class="p">(</span><span class="s2">"regions.parquet"</span><span class="p">)</span>
</span><span id="__span-10-7"><a href="#__codelineno-10-7" id="__codelineno-10-7" name="__codelineno-10-7"></a>
</span><span id="__span-10-8"><a href="#__codelineno-10-8" id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="c1"># Set coordinate system metadata</span>
</span><span id="__span-10-9"><a href="#__codelineno-10-9" id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="n">lf1</span> <span class="o">=</span> <span class="n">lf1</span><span class="o">.</span><span class="n">config_meta</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">coordinate_system_zero_based</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-10-10"><a href="#__codelineno-10-10" id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="n">lf2</span> <span class="o">=</span> <span class="n">lf2</span><span class="o">.</span><span class="n">config_meta</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">coordinate_system_zero_based</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-10-11"><a href="#__codelineno-10-11" id="__codelineno-10-11" name="__codelineno-10-11"></a>
</span><span id="__span-10-12"><a href="#__codelineno-10-12" id="__codelineno-10-12" name="__codelineno-10-12"></a><span class="c1"># Range operation uses Arrow C Stream for efficient data transfer</span>
</span><span id="__span-10-13"><a href="#__codelineno-10-13" id="__codelineno-10-13" name="__codelineno-10-13"></a><span class="n">result</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">overlap</span><span class="p">(</span>
</span><span id="__span-10-14"><a href="#__codelineno-10-14" id="__codelineno-10-14" name="__codelineno-10-14"></a>    <span class="n">lf1</span><span class="p">,</span> <span class="n">lf2</span><span class="p">,</span>
</span><span id="__span-10-15"><a href="#__codelineno-10-15" id="__codelineno-10-15" name="__codelineno-10-15"></a>    <span class="n">cols1</span><span class="o">=</span><span class="p">[</span><span class="s2">"chrom"</span><span class="p">,</span> <span class="s2">"start"</span><span class="p">,</span> <span class="s2">"end"</span><span class="p">],</span>
</span><span id="__span-10-16"><a href="#__codelineno-10-16" id="__codelineno-10-16" name="__codelineno-10-16"></a>    <span class="n">cols2</span><span class="o">=</span><span class="p">[</span><span class="s2">"chrom"</span><span class="p">,</span> <span class="s2">"start"</span><span class="p">,</span> <span class="s2">"end"</span><span class="p">],</span>
</span><span id="__span-10-17"><a href="#__codelineno-10-17" id="__codelineno-10-17" name="__codelineno-10-17"></a>    <span class="n">output_type</span><span class="o">=</span><span class="s2">"polars.LazyFrame"</span>
</span><span id="__span-10-18"><a href="#__codelineno-10-18" id="__codelineno-10-18" name="__codelineno-10-18"></a><span class="p">)</span>
</span><span id="__span-10-19"><a href="#__codelineno-10-19" id="__codelineno-10-19" name="__codelineno-10-19"></a>
</span><span id="__span-10-20"><a href="#__codelineno-10-20" id="__codelineno-10-20" name="__codelineno-10-20"></a><span class="c1"># Execute with Polars streaming engine</span>
</span><span id="__span-10-21"><a href="#__codelineno-10-21" id="__codelineno-10-21" name="__codelineno-10-21"></a><span class="n">result</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">engine</span><span class="o">=</span><span class="s2">"streaming"</span><span class="p">)</span>
</span></code></pre></div>
<h2 id="metadata-flow-polars-arrow">Metadata Flow: Polars ‚Üî Arrow<a class="headerlink" href="#metadata-flow-polars-arrow" title="Permanent link"></a></h2>
<p>polars-bio maintains rich metadata (coordinate system, source format, file headers) across the boundary between Polars DataFrames and the Arrow/DataFusion layer. This section describes how metadata is stored, transferred, and preserved.</p>
<h3 id="overview_1">Overview<a class="headerlink" href="#overview_1" title="Permanent link"></a></h3>
<pre class="mermaid"><code>flowchart TB
    subgraph Read["Read Path (file ‚Üí Polars)"]
        direction TB
        file["Genomic File&lt;br/&gt;(BAM, VCF, GFF, ...)"]
        tp["TableProvider&lt;br/&gt;(Rust, datafusion-bio-formats)"]
        arrow_schema["Arrow Schema&lt;br/&gt;with bio.* metadata"]
        extract["extract_all_schema_metadata()&lt;br/&gt;(Python)"]
        polars_meta["Polars config_meta&lt;br/&gt;(coordinate_system, source_format,&lt;br/&gt;source_path, source_header)"]

        file --&gt; tp
        tp --&gt; |"py_get_table_schema()"| arrow_schema
        arrow_schema --&gt; extract
        extract --&gt; |"set_coordinate_system()&lt;br/&gt;set_source_metadata()"| polars_meta
    end

    subgraph Write["Write Path (Polars ‚Üí file)"]
        direction TB
        polars_meta_w["Polars config_meta&lt;br/&gt;(source_header JSON)"]
        arrow_schema_w["Arrow Schema&lt;br/&gt;with VCF field metadata"]
        tp_w["TableProvider::insert_into()&lt;br/&gt;(Rust)"]
        file_w["Output File"]

        polars_meta_w --&gt; |"apply_vcf_metadata_to_schema()"| arrow_schema_w
        arrow_schema_w --&gt; tp_w
        tp_w --&gt; file_w
    end</code></pre>
<h3 id="arrow-side-metadata-datafusionrust">Arrow-side metadata (DataFusion/Rust)<a class="headerlink" href="#arrow-side-metadata-datafusionrust" title="Permanent link"></a></h3>
<p>When a <code>TableProvider</code> registers a file, the upstream <code>datafusion-bio-formats</code> crates embed format-specific metadata into the Arrow schema using <code>bio.*</code>-prefixed keys:</p>
<table>
<thead>
<tr>
<th>Key prefix</th>
<th>Format</th>
<th>Examples</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bio.coordinate_system_zero_based</code></td>
<td>All</td>
<td><code>"true"</code> or <code>"false"</code></td>
</tr>
<tr>
<td><code>bio.vcf.file_format</code></td>
<td>VCF</td>
<td><code>"VCFv4.2"</code></td>
</tr>
<tr>
<td><code>bio.vcf.contigs</code></td>
<td>VCF</td>
<td>JSON array of contig definitions</td>
</tr>
<tr>
<td><code>bio.vcf.filters</code></td>
<td>VCF</td>
<td>JSON array of filter definitions</td>
</tr>
<tr>
<td><code>bio.vcf.field.*</code></td>
<td>VCF</td>
<td>Per-field metadata (<code>field_type</code>, <code>number</code>, <code>type</code>, <code>description</code>)</td>
</tr>
<tr>
<td><code>bio.bam.*</code></td>
<td>BAM/SAM/CRAM</td>
<td>Format-specific metadata</td>
</tr>
<tr>
<td><code>bio.gff.*</code></td>
<td>GFF</td>
<td>Format-specific metadata</td>
</tr>
<tr>
<td><code>bio.fastq.*</code></td>
<td>FASTQ</td>
<td>Format-specific metadata</td>
</tr>
</tbody>
</table>
<p>The Arrow schema is extracted <strong>without materializing any data</strong> via <code>py_get_table_schema()</code>, which calls <code>table.schema().as_arrow()</code> in Rust.</p>
<h3 id="polars-side-metadata-python">Polars-side metadata (Python)<a class="headerlink" href="#polars-side-metadata-python" title="Permanent link"></a></h3>
<p>On the Python side, metadata is stored using the <a href="https://github.com/ion-elgreco/polars-config-meta">polars-config-meta</a> library, which attaches key-value pairs to Polars DataFrames and LazyFrames via <code>config_meta</code>:</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>coordinate_system_zero_based</code></td>
<td><code>bool</code></td>
<td><code>True</code> = 0-based half-open, <code>False</code> = 1-based closed</td>
</tr>
<tr>
<td><code>source_format</code></td>
<td><code>str</code></td>
<td>Format identifier (<code>"vcf"</code>, <code>"bam"</code>, <code>"gff"</code>, ...)</td>
</tr>
<tr>
<td><code>source_path</code></td>
<td><code>str</code></td>
<td>Original file path</td>
</tr>
<tr>
<td><code>source_header</code></td>
<td><code>str</code></td>
<td>JSON-encoded format-specific header data</td>
</tr>
</tbody>
</table>
<p>For Pandas DataFrames, the same keys are stored in <code>df.attrs</code>.</p>
<h3 id="read-path-arrow-polars">Read path: Arrow ‚Üí Polars<a class="headerlink" href="#read-path-arrow-polars" title="Permanent link"></a></h3>
<p>When <code>scan_*()</code> or <code>read_*()</code> is called, the I/O pipeline transfers metadata in three steps:</p>
<ol>
<li><strong>Register table</strong> ‚Äî <code>py_register_table()</code> creates a DataFusion <code>TableProvider</code> that embeds <code>bio.*</code> metadata in the Arrow schema</li>
<li><strong>Extract schema</strong> ‚Äî <code>py_get_table_schema()</code> returns the PyArrow schema; <code>extract_all_schema_metadata()</code> parses all <code>bio.*</code> keys into a structured dict with format-specific parsers (VCF fields, sample names, contigs, etc.)</li>
<li><strong>Set Polars metadata</strong> ‚Äî <code>set_coordinate_system()</code> and <code>set_source_metadata()</code> attach the parsed metadata to the LazyFrame via <code>config_meta</code></li>
</ol>
<div class="language-python highlight"><pre><span></span><code><span id="__span-11-1"><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="c1"># Internally, _read_file() does:</span>
</span><span id="__span-11-2"><a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="n">table</span> <span class="o">=</span> <span class="n">py_register_table</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">input_format</span><span class="p">,</span> <span class="n">read_options</span><span class="p">)</span>
</span><span id="__span-11-3"><a href="#__codelineno-11-3" id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="n">schema</span> <span class="o">=</span> <span class="n">py_get_table_schema</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>          <span class="c1"># Arrow schema with bio.* metadata</span>
</span><span id="__span-11-4"><a href="#__codelineno-11-4" id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="n">full_metadata</span> <span class="o">=</span> <span class="n">extract_all_schema_metadata</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>     <span class="c1"># Parse into structured dict</span>
</span><span id="__span-11-5"><a href="#__codelineno-11-5" id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="n">lf</span> <span class="o">=</span> <span class="n">_lazy_scan</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>                            <span class="c1"># Create LazyFrame</span>
</span><span id="__span-11-6"><a href="#__codelineno-11-6" id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="n">set_coordinate_system</span><span class="p">(</span><span class="n">lf</span><span class="p">,</span> <span class="n">zero_based</span><span class="p">)</span>                   <span class="c1"># Attach to config_meta</span>
</span><span id="__span-11-7"><a href="#__codelineno-11-7" id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="n">set_source_metadata</span><span class="p">(</span><span class="n">lf</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">"vcf"</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header_metadata</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="write-path-polars-arrow">Write path: Polars ‚Üí Arrow<a class="headerlink" href="#write-path-polars-arrow" title="Permanent link"></a></h3>
<p>When writing files (e.g., <code>write_vcf()</code>, <code>sink_bam()</code>), metadata flows back from the Polars DataFrame to the Arrow schema:</p>
<ol>
<li><strong>Extract Polars metadata</strong> ‚Äî <code>get_metadata()</code> reads <code>source_header</code> JSON from <code>config_meta</code></li>
<li><strong>Apply to Arrow schema</strong> ‚Äî <code>apply_vcf_metadata_to_schema()</code> (Rust) converts the JSON metadata back into Arrow field-level metadata (<code>bio.vcf.field.*</code> keys)</li>
<li><strong>Write with headers</strong> ‚Äî The <code>TableProvider::insert_into()</code> implementation uses the schema metadata to write proper file headers (VCF INFO/FORMAT definitions, BAM <code>@SQ</code>/<code>@RG</code>/<code>@PG</code> records, etc.)</li>
</ol>
<h3 id="metadata-preservation">Metadata preservation<a class="headerlink" href="#metadata-preservation" title="Permanent link"></a></h3>
<p>Polars metadata set via <code>config_meta</code> is preserved through most Polars operations:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-12-1"><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="n">lf</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">scan_vcf</span><span class="p">(</span><span class="s2">"variants.vcf"</span><span class="p">)</span>
</span><span id="__span-12-2"><a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="n">filtered</span> <span class="o">=</span> <span class="n">lf</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"qual"</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">)</span>    <span class="c1"># metadata preserved</span>
</span><span id="__span-12-3"><a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="n">selected</span> <span class="o">=</span> <span class="n">lf</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s2">"chrom"</span><span class="p">,</span> <span class="s2">"start"</span><span class="p">])</span>       <span class="c1"># metadata preserved</span>
</span><span id="__span-12-4"><a href="#__codelineno-12-4" id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="n">limited</span> <span class="o">=</span> <span class="n">lf</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>                         <span class="c1"># metadata preserved</span>
</span><span id="__span-12-5"><a href="#__codelineno-12-5" id="__codelineno-12-5" name="__codelineno-12-5"></a>
</span><span id="__span-12-6"><a href="#__codelineno-12-6" id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="c1"># All share the same metadata</span>
</span><span id="__span-12-7"><a href="#__codelineno-12-7" id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="k">assert</span> <span class="n">pb</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="n">lf</span><span class="p">)[</span><span class="s2">"format"</span><span class="p">]</span> <span class="o">==</span> <span class="n">pb</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="n">filtered</span><span class="p">)[</span><span class="s2">"format"</span><span class="p">]</span>  <span class="c1"># "vcf"</span>
</span></code></pre></div>
<h3 id="registered-table-metadata">Registered table metadata<a class="headerlink" href="#registered-table-metadata" title="Permanent link"></a></h3>
<p>For registered DataFusion tables, coordinate system metadata can also be read directly from the Arrow schema:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-13-1"><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">polars_bio.context</span><span class="w"> </span><span class="kn">import</span> <span class="n">ctx</span>
</span><span id="__span-13-2"><a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a>
</span><span id="__span-13-3"><a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="n">pb</span><span class="o">.</span><span class="n">register_vcf</span><span class="p">(</span><span class="s2">"variants.vcf"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"my_variants"</span><span class="p">)</span>
</span><span id="__span-13-4"><a href="#__codelineno-13-4" id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="n">df</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s2">"my_variants"</span><span class="p">)</span>
</span><span id="__span-13-5"><a href="#__codelineno-13-5" id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="n">schema</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">schema</span><span class="p">()</span>
</span><span id="__span-13-6"><a href="#__codelineno-13-6" id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="nb">print</span><span class="p">(</span><span class="n">schema</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>  <span class="c1"># {b'bio.coordinate_system_zero_based': b'false', ...}</span>
</span></code></pre></div>
<h2 id="coordinate-system-internals">Coordinate System Internals<a class="headerlink" href="#coordinate-system-internals" title="Permanent link"></a></h2>
<p>polars-bio supports both <strong>0-based half-open</strong> <code>[start, end)</code> and <strong>1-based closed</strong> <code>[start, end]</code> coordinate systems. The user-facing API is documented in <a href="../features/#coordinate-systems-support">Features ‚Äî Coordinate systems support</a>. This section describes how the coordinate system propagates through the internal pipeline and affects query semantics.</p>
<h3 id="end-to-end-flow">End-to-end flow<a class="headerlink" href="#end-to-end-flow" title="Permanent link"></a></h3>
<pre class="mermaid"><code>flowchart LR
    subgraph IO["I/O Layer"]
        scan["scan_*(use_zero_based=...)"]
    end

    subgraph Meta["Metadata Layer"]
        config["config_meta&lt;br/&gt;coordinate_system_zero_based"]
        validate["validate_coordinate_systems()"]
    end

    subgraph Python["Range Operations (Python)"]
        filter_op["FilterOp.Strict&lt;br/&gt;(0-based)&lt;br/&gt;FilterOp.Weak&lt;br/&gt;(1-based)"]
    end

    subgraph Rust["Range Operations (Rust)"]
        upstream["RangesFilterOp"]
        sql_sign["SQL join condition:&lt;br/&gt;Strict ‚Üí '&gt;' (exclusive end)&lt;br/&gt;Weak ‚Üí '&gt;=' (inclusive end)"]
    end

    scan --&gt; config
    config --&gt; validate
    validate --&gt; filter_op
    filter_op --&gt; |"PyO3"| upstream
    upstream --&gt; sql_sign</code></pre>
<h3 id="how-it-works_1">How it works<a class="headerlink" href="#how-it-works_1" title="Permanent link"></a></h3>
<ol>
<li>
<p><strong>I/O sets metadata</strong> ‚Äî When <code>scan_*()</code> or <code>read_*()</code> is called, <code>set_coordinate_system(lf, zero_based)</code> stores the coordinate system in <code>config_meta</code>. The <code>use_zero_based</code> parameter defaults to the global session setting <code>datafusion.bio.coordinate_system_zero_based</code>.</p>
</li>
<li>
<p><strong>Validation at operation time</strong> ‚Äî Before every range operation (<code>overlap</code>, <code>nearest</code>, <code>count_overlaps</code>, <code>coverage</code>, <code>merge</code>), <code>validate_coordinate_systems()</code> reads <code>config_meta</code> from both input DataFrames and checks they match. In strict mode (<code>coordinate_system_check=true</code>), missing metadata raises <code>MissingCoordinateSystemError</code>. In lenient mode (default), it falls back to the global setting with a warning.</p>
</li>
<li>
<p><strong>Coordinate system ‚Üí FilterOp</strong> ‚Äî The validated boolean is mapped to a <code>FilterOp</code> enum:</p>
<table>
<thead>
<tr>
<th style="text-align: center;"><code>zero_based</code></th>
<th style="text-align: center;"><code>FilterOp</code></th>
<th style="text-align: center;">Interval semantics</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><code>True</code></td>
<td style="text-align: center;"><code>Strict</code></td>
<td style="text-align: center;"><code>[start, end)</code> ‚Äî end is exclusive</td>
</tr>
<tr>
<td style="text-align: center;"><code>False</code></td>
<td style="text-align: center;"><code>Weak</code></td>
<td style="text-align: center;"><code>[start, end]</code> ‚Äî end is inclusive</td>
</tr>
</tbody>
</table>
</li>
<li>
<p><strong>FilterOp ‚Üí SQL join condition</strong> ‚Äî In Rust, <code>FilterOp</code> controls the comparison operator in the interval overlap predicate:</p>
<ul>
<li><strong>Strict</strong> (0-based): <code>a.start &lt; b.end AND a.end &gt; b.start</code> ‚Äî strict inequalities because end positions are exclusive</li>
<li><strong>Weak</strong> (1-based): <code>a.start &lt;= b.end AND a.end &gt;= b.start</code> ‚Äî weak inequalities because end positions are inclusive</li>
</ul>
</li>
</ol>
<h3 id="storage-locations">Storage locations<a class="headerlink" href="#storage-locations" title="Permanent link"></a></h3>
<p>The coordinate system is stored in different places depending on the context:</p>
<table>
<thead>
<tr>
<th>Context</th>
<th>Storage</th>
<th>Key</th>
</tr>
</thead>
<tbody>
<tr>
<td>Polars DataFrame/LazyFrame</td>
<td><code>config_meta</code> (polars-config-meta)</td>
<td><code>coordinate_system_zero_based</code></td>
</tr>
<tr>
<td>Pandas DataFrame</td>
<td><code>df.attrs</code></td>
<td><code>coordinate_system_zero_based</code></td>
</tr>
<tr>
<td>DataFusion registered table</td>
<td>Arrow schema metadata</td>
<td><code>bio.coordinate_system_zero_based</code></td>
</tr>
<tr>
<td>Session default</td>
<td>DataFusion config</td>
<td><code>datafusion.bio.coordinate_system_zero_based</code></td>
</tr>
</tbody>
</table>
<h3 id="session-parameters">Session parameters<a class="headerlink" href="#session-parameters" title="Permanent link"></a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>datafusion.bio.coordinate_system_zero_based</code></td>
<td><code>"false"</code> (1-based)</td>
<td>Global default applied when <code>use_zero_based</code> is not specified</td>
</tr>
<tr>
<td><code>datafusion.bio.coordinate_system_check</code></td>
<td><code>"false"</code> (lenient)</td>
<td><code>"true"</code> = raise error on missing metadata; <code>"false"</code> = fall back to global default with warning</td>
</tr>
</tbody>
</table>
<h3 id="format-defaults">Format defaults<a class="headerlink" href="#format-defaults" title="Permanent link"></a></h3>
<p>Different file formats have conventional coordinate systems. polars-bio uses the global default (1-based) for all formats, but users can override at I/O time with <code>use_zero_based=True</code>:</p>
<table>
<thead>
<tr>
<th>Format</th>
<th>Convention</th>
<th>polars-bio default</th>
</tr>
</thead>
<tbody>
<tr>
<td>VCF</td>
<td>1-based</td>
<td>1-based</td>
</tr>
<tr>
<td>GFF</td>
<td>1-based</td>
<td>1-based</td>
</tr>
<tr>
<td>SAM/BAM/CRAM</td>
<td>1-based</td>
<td>1-based</td>
</tr>
<tr>
<td>BED</td>
<td>0-based</td>
<td>1-based (override with <code>use_zero_based=True</code>)</td>
</tr>
<tr>
<td>Pairs</td>
<td>0-based or 1-based</td>
<td>1-based</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>BED format conventionally uses 0-based coordinates. If your pipeline mixes BED files with VCF/BAM data, be sure to read BED files with <code>use_zero_based=True</code> or set the global default accordingly ‚Äî otherwise, range operations will produce incorrect results.</p>
</div>
<h2 id="range-operation-algorithm">Range Operation Algorithm<a class="headerlink" href="#range-operation-algorithm" title="Permanent link"></a></h2>
<p><code>polars-bio</code> implements a set of interval operations on genomic ranges, including <em>binary</em> operations (<em>overlap</em>, <em>nearest</em>, <em>count-overlaps</em>, <em>coverage</em>, <em>subtract</em>) and <em>unary</em> operations (<em>merge</em>, <em>cluster</em>, <em>complement</em>). The binary operations share a very similar algorithmic structure, which is presented in the diagram below. The unary operations (<em>merge</em>, <em>cluster</em>, <em>complement</em>) take a single set of intervals and produce transformed output ‚Äî merged intervals, cluster assignments, or gap intervals respectively.</p>
<pre class="mermaid"><code>flowchart TB
    %% Define header node
    H["Interval operation"]

    %% Define DataFrame nodes
    I0["left DataFrame"]
    I1["right DataFrame"]

    style I0 stroke-dasharray: 5 5, stroke-width: 1

    %% Draw edges with labels
    H --&gt;|probe /streaming/ side| I0
    H --&gt;|build /search structure/ side| I1

    %% Record batches under left DataFrame within a dotted box
    I0 --&gt; LeftGroup
    subgraph LeftGroup["Record Batches"]
        direction TB
        LB0["Batch 1"]
        LB1["Batch 2"]
        LB2["Batch 3"]
    end
    style LeftGroup stroke-dasharray: 5 5, stroke-width: 1

    %% Record batches under right DataFrame within a dotted box
    I1 --&gt; RightGroup
    subgraph RightGroup["Record Batches"]
        direction TB
        RB0["Batch 1"]
        RB1["Batch 2"]
        RB2["Batch 3"]
    end
</code></pre>
<p>The basic concept is that each operation consists of two sides: the <strong>probe</strong> side and the <strong>build</strong> side. The <strong>probe</strong> side is the one that is streamed, while the <strong>build</strong> side is the one that is implemented as a search data structure (for generic <em>overlap</em> operation the search structure can be changed using <a href="/polars-bio/api/#polars_bio.range_operations.overlap">algorithm</a> parameter, for other operations is always <a href="https://github.com/dcjones/coitrees">Cache Oblivious Interval Trees</a> as according to the <a href="https://github.com/dcjones/coitrees?tab=readme-ov-file#benchmarks">benchmark</a> COITrees outperforms other data structures). In the case of <em>nearest</em> operation there is an additional sorted list of intervals used for searching for closest intervals in the case of non-existing overlaps.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Available search structure implementations for overlap operation:</p>
<ul>
<li><a href="https://github.com/dcjones/coitrees">COITrees</a></li>
<li><a href="https://github.com/rust-bio/rust-bio/blob/master/src/data_structures/interval_tree/array_backed_interval_tree.rs">IITree</a></li>
<li><a href="https://github.com/rust-bio/rust-bio/blob/master/src/data_structures/interval_tree/avl_interval_tree.rs">AVL-tree</a></li>
<li><a href="https://github.com/sstadick/rust-lapper">rust-lapper</a></li>
<li><a href="https://github.com/kcleal/superintervals/">superintervals</a> - available since <code>polars-bio</code> version <code>0.12.0</code></li>
</ul>
</div>
<p>Once the <strong>build</strong> side data structure is ready, then records from the <strong>probe</strong> side are processed against the search structure organized as record batches. Each record batch can be processed independently. Search structure nodes contains identifiers of the rows from the <strong>build</strong> side that are then used to construct a new record that is returned as a result of the operation.</p>
<h3 id="out-of-core-streaming-processing">Out-of-core (streaming) processing<a class="headerlink" href="#out-of-core-streaming-processing" title="Permanent link"></a></h3>
<p>This algorithm allows you to process your results without requiring <strong>all</strong> your data to be in memory at the same time. In particular, the <strong>probe</strong> side can be streamed from a file stored locally or on a cloud object storage, while the <strong>build</strong> side needs to be fully materialized in memory. In real applications, the <strong>probe</strong> side is usually a large file with genomic intervals, while the <strong>build</strong> side is a smaller file with annotations or other genomic features. This allows you to process large genomic datasets without running out of memory.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol>
<li>In this sense, the <strong>order</strong> of the sides is important, as the <strong>probe</strong> side is streamed and processed in batches, while the <strong>build</strong> side is fully materialized in memory.</li>
<li>The <strong>smaller</strong> the <em>build</em> side and <strong>larger</strong> the number of overlaps are, the <strong>higher</strong> is the gain of memory efficiency. For instance, when we compare the real <code>8-7</code> (<code>10^7 vs. 1.2*10^6</code>) and synthetic (<code>10^7 vs. 10^7</code>) datasets, we can see that we benefit more from using streaming mode in the <strong>former</strong> benchmark.</li>
</ol>
</div>
<h3 id="parallelization">Parallelization<a class="headerlink" href="#parallelization" title="Permanent link"></a></h3>
<p>In the current implementation, the <strong>probe</strong> side can be processed in parallel using multiple threads on partitioned (implicitly or explicitly partitioned inputs ‚Äî see <a href="../features/#parallel-engine">parallel engine</a>). The <strong>build</strong> side is predominantly single-threaded (with the notable exception of BGZF compressed or partitioned Parquet/CSV input data files reading, which can be parallelized).</p>
<h2 id="comparison-with-existing-tools">Comparison with Existing Tools<a class="headerlink" href="#comparison-with-existing-tools" title="Permanent link"></a></h2>
<p>The table below compares <code>polars-bio</code> with other popular Python libraries for genomic ranges operations.</p>
<table>
<thead>
<tr>
<th>Feature/Library</th>
<th>polars-bio</th>
<th>Bioframe</th>
<th>PyRanges0</th>
<th>PyRanges1</th>
<th>pybedtools</th>
<th>GenomicRanges</th>
</tr>
</thead>
<tbody>
<tr>
<td>out-of-core processing</td>
<td>‚úÖ</td>
<td>‚ùå</td>
<td>‚ùå</td>
<td>‚ùå</td>
<td>‚ùå</td>
<td>‚ùå</td>
</tr>
<tr>
<td>parallel processing</td>
<td>‚úÖ</td>
<td>‚ùå</td>
<td>‚úÖ<sup>1</sup></td>
<td>‚ùå</td>
<td>‚ùå</td>
<td>‚ùå</td>
</tr>
<tr>
<td>vectorized execution engine</td>
<td>‚úÖ</td>
<td>‚ùå</td>
<td>‚ùå</td>
<td>‚ùå</td>
<td>‚ùå</td>
<td>‚ùå</td>
</tr>
<tr>
<td>cloud object storage support</td>
<td>‚úÖ</td>
<td>‚úÖ/‚ùå<sup>2</sup></td>
<td>‚ùå</td>
<td>‚ùå</td>
<td>‚ùå</td>
<td>‚úÖ</td>
</tr>
<tr>
<td>Pandas/Polars DataFrame support</td>
<td>‚úÖ/‚úÖ</td>
<td>‚úÖ/‚ùå</td>
<td>‚úÖ/‚ùå<sup>3</sup></td>
<td>‚úÖ/‚ùå<sup>4</sup></td>
<td>‚ùå/‚ùå</td>
<td>‚úÖ/‚úÖ</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><sup>1</sup> PyRanges0 supports parallel processing with <a href="https://github.com/ray-project/ray">Ray</a>, but it does not bring any performance benefits over single-threaded <a href="https://github.com/pyranges/pyranges/issues/363">execution</a> and it is not recommended.</p>
<p><sup>2</sup> Some input functions, such as <code>read_table</code> support cloud object storage</p>
<p><sup>3</sup> Only export/import with data copying is <a href="https://pyranges.readthedocs.io/en/latest/tutorial.html#pandas-vs-pyranges">supported</a></p>
<p><sup>4</sup> RangeFrame class extends Pandas DataFrame</p>
</div>
<h2 id="datafusion-extension-points">DataFusion Extension Points<a class="headerlink" href="#datafusion-extension-points" title="Permanent link"></a></h2>
<p>polars-bio uses the following <a href="https://datafusion.apache.org/">Apache DataFusion</a> extension points:</p>
<h3 id="physicaloptimizerrule-for-interval-join-rewriting">PhysicalOptimizerRule for interval join rewriting<a class="headerlink" href="#physicaloptimizerrule-for-interval-join-rewriting" title="Permanent link"></a></h3>
<p><a href="https://docs.rs/datafusion/50.3.0/datafusion/physical_planner/struct.DefaultPhysicalPlanner.html">DefaultPhysicalPlanner</a> and <a href="https://docs.rs/datafusion/50.3.0/datafusion/physical_optimizer/trait.PhysicalOptimizerRule.html">PhysicalOptimizerRule</a> are used for detecting and rewriting <strong>generic</strong> interval join operations (i.e. <em>overlap</em> and <em>nearest</em>) with optimized execution strategies. This is implemented in <a href="https://github.com/biodatageeks/datafusion-bio-functions">datafusion-bio-function-ranges</a> which exposes optimized interval join operations for Apache DataFusion with both SQL and DataFrame APIs.</p>
<h3 id="tableprovider-udtf-for-specialized-operations">TableProvider + UDTF for specialized operations<a class="headerlink" href="#tableprovider-udtf-for-specialized-operations" title="Permanent link"></a></h3>
<p><a href="https://docs.rs/datafusion/50.3.0/datafusion/catalog/trait.TableProvider.html">TableProvider</a> and <a href="https://datafusion.apache.org/library-user-guide/functions/adding-udfs.html#adding-a-user-defined-table-function">User-Defined Table Function</a> mechanisms are used for implementing <strong>specialized</strong> operations:</p>
<ul>
<li><strong>coverage</strong> and <strong>count-overlaps</strong>: Implemented as UDTFs in <code>datafusion-bio-function-ranges</code></li>
<li><strong>depth (pileup)</strong>: Implemented as a UDTF in <code>datafusion-bio-function-pileup</code>, registered as <code>depth()</code> in SQL</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-14-1"><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">polars_bio</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pb</span>
</span><span id="__span-14-2"><a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a>
</span><span id="__span-14-3"><a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="c1"># Coverage via UDTF</span>
</span><span id="__span-14-4"><a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="n">result</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">coverage</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">)</span>
</span><span id="__span-14-5"><a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a>
</span><span id="__span-14-6"><a href="#__codelineno-14-6" id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="c1"># Depth via SQL UDTF</span>
</span><span id="__span-14-7"><a href="#__codelineno-14-7" id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="n">result</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">"SELECT * FROM depth('alignments.bam')"</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</span></code></pre></div>
<h2 id="predicate-projection-pushdown-examples">Predicate &amp; Projection Pushdown Examples<a class="headerlink" href="#predicate-projection-pushdown-examples" title="Permanent link"></a></h2>
<p>This section provides concrete usage examples and execution plan inspection for the pushdown optimizations described in the <a href="#predicate-pushdown">I/O Pipeline</a> section above.</p>
<h3 id="record-level-filter-pushdown">Record-level filter pushdown<a class="headerlink" href="#record-level-filter-pushdown" title="Permanent link"></a></h3>
<p>Beyond index-based region queries, all formats support <strong>record-level predicate evaluation</strong>. Filters on columns like <code>mapping_quality</code>, <code>flag</code>, <code>score</code>, or <code>strand</code> are evaluated as each record is read, filtering early before Arrow RecordBatch construction.</p>
<p>This works <strong>with or without</strong> an index file:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-15-1"><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">polars</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pl</span>
</span><span id="__span-15-2"><a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">polars_bio</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pb</span>
</span><span id="__span-15-3"><a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a>
</span><span id="__span-15-4"><a href="#__codelineno-15-4" id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="c1"># No index needed ‚Äî filters applied per-record during scan</span>
</span><span id="__span-15-5"><a href="#__codelineno-15-5" id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-15-6"><a href="#__codelineno-15-6" id="__codelineno-15-6" name="__codelineno-15-6"></a>    <span class="n">pb</span><span class="o">.</span><span class="n">scan_bam</span><span class="p">(</span><span class="s2">"alignments.bam"</span><span class="p">)</span>
</span><span id="__span-15-7"><a href="#__codelineno-15-7" id="__codelineno-15-7" name="__codelineno-15-7"></a>    <span class="o">.</span><span class="n">filter</span><span class="p">((</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"mapping_quality"</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">30</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"flag"</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="__span-15-8"><a href="#__codelineno-15-8" id="__codelineno-15-8" name="__codelineno-15-8"></a>    <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</span><span id="__span-15-9"><a href="#__codelineno-15-9" id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="p">)</span>
</span><span id="__span-15-10"><a href="#__codelineno-15-10" id="__codelineno-15-10" name="__codelineno-15-10"></a>
</span><span id="__span-15-11"><a href="#__codelineno-15-11" id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="c1"># Combine genomic region (uses index) with record filter (applied per-record)</span>
</span><span id="__span-15-12"><a href="#__codelineno-15-12" id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-15-13"><a href="#__codelineno-15-13" id="__codelineno-15-13" name="__codelineno-15-13"></a>    <span class="n">pb</span><span class="o">.</span><span class="n">scan_bam</span><span class="p">(</span><span class="s2">"alignments.bam"</span><span class="p">)</span>
</span><span id="__span-15-14"><a href="#__codelineno-15-14" id="__codelineno-15-14" name="__codelineno-15-14"></a>    <span class="o">.</span><span class="n">filter</span><span class="p">(</span>
</span><span id="__span-15-15"><a href="#__codelineno-15-15" id="__codelineno-15-15" name="__codelineno-15-15"></a>        <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"chrom"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"chr1"</span><span class="p">)</span>
</span><span id="__span-15-16"><a href="#__codelineno-15-16" id="__codelineno-15-16" name="__codelineno-15-16"></a>        <span class="o">&amp;</span> <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"start"</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1000000</span><span class="p">)</span>
</span><span id="__span-15-17"><a href="#__codelineno-15-17" id="__codelineno-15-17" name="__codelineno-15-17"></a>        <span class="o">&amp;</span> <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">"mapping_quality"</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">30</span><span class="p">)</span>
</span><span id="__span-15-18"><a href="#__codelineno-15-18" id="__codelineno-15-18" name="__codelineno-15-18"></a>    <span class="p">)</span>
</span><span id="__span-15-19"><a href="#__codelineno-15-19" id="__codelineno-15-19" name="__codelineno-15-19"></a>    <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</span><span id="__span-15-20"><a href="#__codelineno-15-20" id="__codelineno-15-20" name="__codelineno-15-20"></a><span class="p">)</span>
</span></code></pre></div>
<h3 id="projection-pushdown_1">Projection pushdown<a class="headerlink" href="#projection-pushdown_1" title="Permanent link"></a></h3>
<p>BAM, CRAM, VCF, and Pairs formats support <strong>parsing-level projection pushdown</strong>. When you select a subset of columns, unprojected fields are skipped entirely during record parsing ‚Äî no string formatting, sequence decoding, map lookups, or memory allocation for those fields. This can significantly reduce I/O and CPU time, especially for wide schemas like BAM (11+ columns) where you only need a few fields.</p>
<p>Projection pushdown is <strong>enabled by default</strong> (<code>projection_pushdown=True</code>) on all <code>scan_*</code>/<code>read_*</code> calls and range operations. To disable it, pass <code>projection_pushdown=False</code>.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-16-1"><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">polars_bio</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pb</span>
</span><span id="__span-16-2"><a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a>
</span><span id="__span-16-3"><a href="#__codelineno-16-3" id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="c1"># Only name and chrom are parsed from each BAM record (projection pushdown is on by default)</span>
</span><span id="__span-16-4"><a href="#__codelineno-16-4" id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-16-5"><a href="#__codelineno-16-5" id="__codelineno-16-5" name="__codelineno-16-5"></a>    <span class="n">pb</span><span class="o">.</span><span class="n">scan_bam</span><span class="p">(</span><span class="s2">"alignments.bam"</span><span class="p">)</span>
</span><span id="__span-16-6"><a href="#__codelineno-16-6" id="__codelineno-16-6" name="__codelineno-16-6"></a>    <span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s2">"name"</span><span class="p">,</span> <span class="s2">"chrom"</span><span class="p">])</span>
</span><span id="__span-16-7"><a href="#__codelineno-16-7" id="__codelineno-16-7" name="__codelineno-16-7"></a>    <span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</span><span id="__span-16-8"><a href="#__codelineno-16-8" id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="p">)</span>
</span><span id="__span-16-9"><a href="#__codelineno-16-9" id="__codelineno-16-9" name="__codelineno-16-9"></a>
</span><span id="__span-16-10"><a href="#__codelineno-16-10" id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="c1"># Works the same for CRAM and VCF</span>
</span><span id="__span-16-11"><a href="#__codelineno-16-11" id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="n">df</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">scan_cram</span><span class="p">(</span><span class="s2">"alignments.cram"</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s2">"name"</span><span class="p">,</span> <span class="s2">"chrom"</span><span class="p">])</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</span><span id="__span-16-12"><a href="#__codelineno-16-12" id="__codelineno-16-12" name="__codelineno-16-12"></a>
</span><span id="__span-16-13"><a href="#__codelineno-16-13" id="__codelineno-16-13" name="__codelineno-16-13"></a><span class="c1"># Works with SQL too ‚Äî only referenced columns are parsed</span>
</span><span id="__span-16-14"><a href="#__codelineno-16-14" id="__codelineno-16-14" name="__codelineno-16-14"></a><span class="n">pb</span><span class="o">.</span><span class="n">register_vcf</span><span class="p">(</span><span class="s2">"variants.vcf.gz"</span><span class="p">,</span> <span class="s2">"variants"</span><span class="p">)</span>
</span><span id="__span-16-15"><a href="#__codelineno-16-15" id="__codelineno-16-15" name="__codelineno-16-15"></a><span class="n">result</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">"SELECT chrom, start FROM variants"</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</span></code></pre></div>
<h3 id="inspecting-the-execution-plan">Inspecting the execution plan<a class="headerlink" href="#inspecting-the-execution-plan" title="Permanent link"></a></h3>
<p>You can verify pushdown is active by inspecting the physical execution plan:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-17-1"><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">polars_bio.context</span><span class="w"> </span><span class="kn">import</span> <span class="n">ctx</span>
</span><span id="__span-17-2"><a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">polars_bio.polars_bio</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="__span-17-3"><a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a>    <span class="n">InputFormat</span><span class="p">,</span> <span class="n">ReadOptions</span><span class="p">,</span> <span class="n">BamReadOptions</span><span class="p">,</span>
</span><span id="__span-17-4"><a href="#__codelineno-17-4" id="__codelineno-17-4" name="__codelineno-17-4"></a>    <span class="n">py_register_table</span><span class="p">,</span> <span class="n">py_read_table</span><span class="p">,</span>
</span><span id="__span-17-5"><a href="#__codelineno-17-5" id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="p">)</span>
</span><span id="__span-17-6"><a href="#__codelineno-17-6" id="__codelineno-17-6" name="__codelineno-17-6"></a>
</span><span id="__span-17-7"><a href="#__codelineno-17-7" id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="n">read_options</span> <span class="o">=</span> <span class="n">ReadOptions</span><span class="p">(</span><span class="n">bam_read_options</span><span class="o">=</span><span class="n">BamReadOptions</span><span class="p">())</span>
</span><span id="__span-17-8"><a href="#__codelineno-17-8" id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="n">table</span> <span class="o">=</span> <span class="n">py_register_table</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="s2">"alignments.bam"</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">InputFormat</span><span class="o">.</span><span class="n">Bam</span><span class="p">,</span> <span class="n">read_options</span><span class="p">)</span>
</span><span id="__span-17-9"><a href="#__codelineno-17-9" id="__codelineno-17-9" name="__codelineno-17-9"></a><span class="n">df</span> <span class="o">=</span> <span class="n">py_read_table</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">select_columns</span><span class="p">(</span><span class="s2">"name"</span><span class="p">,</span> <span class="s2">"chrom"</span><span class="p">)</span>
</span><span id="__span-17-10"><a href="#__codelineno-17-10" id="__codelineno-17-10" name="__codelineno-17-10"></a><span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">execution_plan</span><span class="p">())</span>
</span><span id="__span-17-11"><a href="#__codelineno-17-11" id="__codelineno-17-11" name="__codelineno-17-11"></a><span class="c1"># CooperativeExec</span>
</span><span id="__span-17-12"><a href="#__codelineno-17-12" id="__codelineno-17-12" name="__codelineno-17-12"></a><span class="c1">#   BamExec: projection=[name, chrom]    &lt;-- only 2 of 11 columns parsed</span>
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><code>COUNT(*)</code> queries also benefit ‚Äî when no columns are needed, the empty projection path avoids parsing any fields while still counting records correctly.</p>
</div>
<h2 id="building-development">Building &amp; Development<a class="headerlink" href="#building-development" title="Permanent link"></a></h2>
<h3 id="building-from-source">Building from source<a class="headerlink" href="#building-from-source" title="Permanent link"></a></h3>
<p>polars-bio can be built from source using <a href="https://github.com/PyO3/maturin">maturin</a> and <a href="https://python-poetry.org/">poetry</a>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/biodatageeks/polars-bio.git
</span><span id="__span-18-2"><a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="nb">cd</span><span class="w"> </span>polars-bio
</span><span id="__span-18-3"><a href="#__codelineno-18-3" id="__codelineno-18-3" name="__codelineno-18-3"></a>poetry<span class="w"> </span>env<span class="w"> </span>use<span class="w"> </span><span class="m">3</span>.12
</span><span id="__span-18-4"><a href="#__codelineno-18-4" id="__codelineno-18-4" name="__codelineno-18-4"></a>poetry<span class="w"> </span>update
</span><span id="__span-18-5"><a href="#__codelineno-18-5" id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="nv">RUSTFLAGS</span><span class="o">=</span><span class="s2">"-Ctarget-cpu=native"</span><span class="w"> </span>maturin<span class="w"> </span>build<span class="w"> </span>--release<span class="w"> </span>-m<span class="w"> </span>Cargo.toml
</span><span id="__span-18-6"><a href="#__codelineno-18-6" id="__codelineno-18-6" name="__codelineno-18-6"></a>pip<span class="w"> </span>install<span class="w"> </span>target/wheels/polars_bio-*.whl
</span></code></pre></div>
<p>For development (installs directly into the current virtual environment):</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="nv">RUSTFLAGS</span><span class="o">=</span><span class="s2">"-Ctarget-cpu=native"</span><span class="w"> </span>maturin<span class="w"> </span>develop<span class="w"> </span>--release<span class="w"> </span>-m<span class="w"> </span>Cargo.toml
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Required dependencies</p>
<ul>
<li>Python &gt;= 3.10, &lt; 3.15 (3.12 or 3.13 recommended, 3.14 is <strong>experimental</strong>)</li>
<li><a href="https://python-poetry.org/">poetry</a></li>
<li>cmake</li>
<li>Rust compiler + Cargo (<a href="https://rustup.rs/">rustup</a> recommended)</li>
</ul>
</div>
<h3 id="running-tests">Running tests<a class="headerlink" href="#running-tests" title="Permanent link"></a></h3>
<p>Unit and integration tests use <a href="https://docs.pytest.org/">pytest</a>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="c1"># Run all tests</span>
</span><span id="__span-20-2"><a href="#__codelineno-20-2" id="__codelineno-20-2" name="__codelineno-20-2"></a>python<span class="w"> </span>-m<span class="w"> </span>pytest<span class="w"> </span>tests/<span class="w"> </span>-v
</span><span id="__span-20-3"><a href="#__codelineno-20-3" id="__codelineno-20-3" name="__codelineno-20-3"></a>
</span><span id="__span-20-4"><a href="#__codelineno-20-4" id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="c1"># Run specific test modules</span>
</span><span id="__span-20-5"><a href="#__codelineno-20-5" id="__codelineno-20-5" name="__codelineno-20-5"></a>python<span class="w"> </span>-m<span class="w"> </span>pytest<span class="w"> </span>tests/test_io_bam.py<span class="w"> </span>-v
</span><span id="__span-20-6"><a href="#__codelineno-20-6" id="__codelineno-20-6" name="__codelineno-20-6"></a>python<span class="w"> </span>-m<span class="w"> </span>pytest<span class="w"> </span>tests/test_io_vcf.py<span class="w"> </span>-v
</span></code></pre></div>
<p>For cloud storage integration tests (requires <code>azure-cli</code> and <code>docker</code>):</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="nb">cd</span><span class="w"> </span>it
</span><span id="__span-21-2"><a href="#__codelineno-21-2" id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="nb">source</span><span class="w"> </span>bin/start.sh
</span><span id="__span-21-3"><a href="#__codelineno-21-3" id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="nv">JUPYTER_PLATFORM_DIRS</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>pytest<span class="w"> </span>it_object_storage_io.py<span class="w"> </span>-o<span class="w"> </span><span class="nv">log_cli</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span>--log-cli-level<span class="o">=</span>INFO
</span><span id="__span-21-4"><a href="#__codelineno-21-4" id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="nb">source</span><span class="w"> </span>bin/stop.sh
</span></code></pre></div>
<p>Check the <code>README</code> in the <code>it</code> directory for more information.</p>
<h3 id="building-documentation">Building documentation<a class="headerlink" href="#building-documentation" title="Permanent link"></a></h3>
<p>The documentation is built with <a href="https://www.mkdocs.org/">MkDocs</a> and the <a href="https://squidfunk.github.io/mkdocs-material/">Material</a> theme:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a href="#__codelineno-22-1" id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="c1"># Full build with all dynamic content</span>
</span><span id="__span-22-2"><a href="#__codelineno-22-2" id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="nv">MKDOCS_EXPORTER_PDF</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="nv">JUPYTER_PLATFORM_DIRS</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>mkdocs<span class="w"> </span>serve<span class="w"> </span>-w<span class="w"> </span>polars_bio
</span></code></pre></div>
<p>To speed up development builds by disabling dynamic content rendering:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a href="#__codelineno-23-1" id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="nv">MKDOCS_EXPORTER_PDF</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="nv">ENABLE_MD_EXEC</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="nv">ENABLE_MKDOCSTRINGS</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="nv">ENABLE_JUPYTER</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="nv">JUPYTER_PLATFORM_DIRS</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>mkdocs<span class="w"> </span>serve
</span></code></pre></div>
<h3 id="rust-compilation-check">Rust compilation check<a class="headerlink" href="#rust-compilation-check" title="Permanent link"></a></h3>
<p>For a quick compilation check without building the full wheel:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a href="#__codelineno-24-1" id="__codelineno-24-1" name="__codelineno-24-1"></a>cargo<span class="w"> </span>check
</span></code></pre></div>
</article>
</div>
<script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: üöÄ Performance" class="md-footer__link md-footer__link--prev" href="../supplement/">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                Previous
              </span>
<div class="md-ellipsis">
                üöÄ Performance
              </div>
</div>
</a>
<a aria-label="Next: üì° Contact" class="md-footer__link md-footer__link--next" href="../contact/">
<div class="md-footer__title">
<span class="md-footer__direction">
                Next
              </span>
<div class="md-ellipsis">
                üì° Contact
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://discord.gg/bpxQ4Yxhk5" rel="noopener" target="_blank" title="Discord">
<svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2"></path></svg>
</a>
<a class="md-social__link" href="mailto:marek.wiewiorka@pw.edu.pl" rel="noopener" target="_blank" title="Email">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m20 8-8 5-8-5V6l8 5 8-5m0-2H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["content.code.copy", "content.code.select", "content.code.annotate", "content.tabs.link", "content.action.edit", "content.tooltips", "toc.follow", "navigation.top", "navigation.tabs", "navigation.tabs.sticky", "navigation.footer", "navigation.tracking", "navigation.instant", "content.footnote.tooltips"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": ["latest"], "provider": "mike"}}</script>
<script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
<script src="../assets/_markdown_exec_pyodide.js"></script>
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>